<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PBR Materials Demo - Metalness & Roughness</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      overflow: hidden;
    }
    
    #viewer-container {
      width: 100vw;
      height: 100vh;
      position: relative;
    }
    
    .controls-panel {
      position: absolute;
      top: 20px;
      left: 20px;
      background: rgba(0, 0, 0, 0.8);
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
      width: 320px;
    }
    
    .controls-panel h2 {
      margin-top: 0;
      color: #fbbf24;
      font-size: 1.5rem;
      border-bottom: 2px solid #fbbf24;
      padding-bottom: 10px;
    }
    
    .control-group {
      margin: 20px 0;
      padding: 15px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 5px;
    }
    
    .control-group h3 {
      margin-top: 0;
      color: #60a5fa;
      font-size: 1.1rem;
    }
    
    .control-row {
      display: flex;
      align-items: center;
      margin: 10px 0;
      justify-content: space-between;
    }
    
    label {
      flex: 1;
      margin-right: 10px;
      font-size: 0.9rem;
    }
    
    input[type="range"] {
      flex: 1.5;
      margin: 0 10px;
    }
    
    .value-display {
      min-width: 50px;
      text-align: right;
      font-family: monospace;
      color: #fbbf24;
    }
    
    button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 0.9rem;
      margin: 5px;
      transition: transform 0.2s;
    }
    
    button:hover {
      transform: scale(1.05);
    }
    
    button:active {
      transform: scale(0.95);
    }
    
    .preset-buttons {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 10px;
    }
    
    select {
      padding: 5px;
      border-radius: 3px;
      background: rgba(255, 255, 255, 0.1);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.3);
    }
    
    input[type="color"] {
      width: 50px;
      height: 30px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div id="viewer-container"></div>
  
  <div class="controls-panel">
    <h2>ðŸ”§ PBR Materials Demo</h2>
    
    <!-- Material Type Selection -->
    <div class="control-group">
      <h3>ðŸ“¦ Material Type</h3>
      <div class="control-row">
        <label>Type:</label>
        <select id="material-type">
          <option value="phong">Phong (Classic)</option>
          <option value="standard">Standard (PBR)</option>
          <option value="physical">Physical (Advanced PBR)</option>
        </select>
      </div>
    </div>
    
    <!-- Phong Material Controls -->
    <div class="control-group" id="phong-controls">
      <h3>ðŸ’¡ Phong Properties</h3>
      
      <div class="control-row">
        <label>Shininess:</label>
        <input type="range" id="shininess" min="0" max="200" value="50">
        <span class="value-display" id="shininess-value">50</span>
      </div>
      
      <div class="control-row">
        <label>Specular Color:</label>
        <input type="color" id="specular-color" value="#666666">
      </div>
    </div>
    
    <!-- PBR Material Controls -->
    <div class="control-group" id="pbr-controls" style="display: none;">
      <h3>ðŸŽ¨ PBR Properties</h3>
      
      <div class="control-row">
        <label>Metalness:</label>
        <input type="range" id="metalness" min="0" max="100" value="0">
        <span class="value-display" id="metalness-value">0%</span>
      </div>
      
      <div class="control-row">
        <label>Roughness:</label>
        <input type="range" id="roughness" min="0" max="100" value="50">
        <span class="value-display" id="roughness-value">50%</span>
      </div>
    </div>
    
    <!-- Shared Properties -->
    <div class="control-group">
      <h3>ðŸŽ¨ Shared Properties</h3>
      
      <div class="control-row">
        <label>Base Color:</label>
        <input type="color" id="base-color" value="#a9a9a9">
      </div>
      
      <div class="control-row">
        <label>Emissive Color:</label>
        <input type="color" id="emissive-color" value="#0a0a0a">
      </div>
      
      <div class="control-row">
        <label>Emissive Intensity:</label>
        <input type="range" id="emissive-intensity" min="0" max="100" value="10">
        <span class="value-display" id="emissive-intensity-value">10%</span>
      </div>
      
      <div class="control-row">
        <label>Opacity:</label>
        <input type="range" id="opacity" min="0" max="100" value="100">
        <span class="value-display" id="opacity-value">100%</span>
      </div>
    </div>
    
    <!-- PBR Presets -->
    <div class="control-group">
      <h3>âš¡ Material Presets</h3>
      <div class="preset-buttons">
        <button id="preset-plastic">Plastic</button>
        <button id="preset-metal">Metal</button>
        <button id="preset-gold">Gold</button>
        <button id="preset-copper">Copper</button>
        <button id="preset-rubber">Rubber</button>
        <button id="preset-glass">Glass</button>
        <button id="preset-ice">Ice</button>
        <button id="preset-ceramic">Ceramic</button>
      </div>
    </div>
  </div>
  
  <script type="module">
    import { 
      NeuroSurfaceViewer,
      SurfaceGeometry,
      ColorMappedNeuroSurface,
      THREE,
      setDebug,
      loadSurface
    } from './src/index.js';
    
    // Enable debug mode
    setDebug(true);
    
    // Create viewer
    const container = document.getElementById('viewer-container');
    const viewer = new NeuroSurfaceViewer(
      container,
      window.innerWidth,
      window.innerHeight,
      {
        showControls: false,
        backgroundColor: 0x1a1a2e
      }
    );
    
    // Start render loop
    viewer.startRenderLoop();
    
    let currentSurface = null;
    let currentMaterialType = 'phong';
    
    // Create test surface
    async function createTestSurface() {
      // Clear existing surfaces
      viewer.getSurfaceIds().forEach(id => {
        viewer.removeSurface(id);
      });
      
      // Create sphere for testing
      const geometry = new THREE.SphereGeometry(50, 64, 64);
      const vertices = new Float32Array(geometry.attributes.position.array);
      const faces = geometry.index ? new Uint32Array(geometry.index.array) : new Uint32Array(0);
      const surfaceGeom = new SurfaceGeometry(vertices, faces, 'test');
      
      // Create data for coloring
      const vertexCount = surfaceGeom.vertices.length / 3;
      const data = new Float32Array(vertexCount);
      
      // Color based on y-coordinate
      for (let i = 0; i < vertexCount; i++) {
        const y = surfaceGeom.vertices[i * 3 + 1];
        data[i] = (y + 50) / 100 * 100; // Normalize to 0-100
      }
      
      // Create surface with initial config
      currentSurface = new ColorMappedNeuroSurface(
        surfaceGeom,
        null,
        data,
        'viridis',
        {
          materialType: currentMaterialType,
          alpha: 1.0,
          flatShading: false,
          // Phong defaults
          shininess: 50,
          specularColor: 0x666666,
          // PBR defaults
          metalness: 0.0,
          roughness: 0.5,
          // Shared
          emissive: 0x0a0a0a,
          emissiveIntensity: 0.1
        }
      );
      
      viewer.addSurface(currentSurface, 'test-surface');
      viewer.centerCamera();
    }
    
    // Update material properties
    function updateMaterial() {
      if (!currentSurface) return;
      
      const config = {
        materialType: document.getElementById('material-type').value,
        color: document.getElementById('base-color').value,
        emissive: document.getElementById('emissive-color').value,
        emissiveIntensity: parseInt(document.getElementById('emissive-intensity').value) / 100,
        alpha: parseInt(document.getElementById('opacity').value) / 100
      };
      
      // Add material-specific properties
      if (config.materialType === 'phong') {
        config.shininess = parseInt(document.getElementById('shininess').value);
        config.specularColor = document.getElementById('specular-color').value;
      } else {
        config.metalness = parseInt(document.getElementById('metalness').value) / 100;
        config.roughness = parseInt(document.getElementById('roughness').value) / 100;
      }
      
      currentSurface.updateConfig(config);
      viewer.render();
    }
    
    // Material type change handler
    document.getElementById('material-type').addEventListener('change', (e) => {
      currentMaterialType = e.target.value;
      
      // Show/hide appropriate controls
      if (currentMaterialType === 'phong') {
        document.getElementById('phong-controls').style.display = 'block';
        document.getElementById('pbr-controls').style.display = 'none';
      } else {
        document.getElementById('phong-controls').style.display = 'none';
        document.getElementById('pbr-controls').style.display = 'block';
      }
      
      updateMaterial();
    });
    
    // Connect sliders to displays
    document.getElementById('shininess').addEventListener('input', (e) => {
      document.getElementById('shininess-value').textContent = e.target.value;
      updateMaterial();
    });
    
    document.getElementById('metalness').addEventListener('input', (e) => {
      document.getElementById('metalness-value').textContent = e.target.value + '%';
      updateMaterial();
    });
    
    document.getElementById('roughness').addEventListener('input', (e) => {
      document.getElementById('roughness-value').textContent = e.target.value + '%';
      updateMaterial();
    });
    
    document.getElementById('emissive-intensity').addEventListener('input', (e) => {
      document.getElementById('emissive-intensity-value').textContent = e.target.value + '%';
      updateMaterial();
    });
    
    document.getElementById('opacity').addEventListener('input', (e) => {
      document.getElementById('opacity-value').textContent = e.target.value + '%';
      updateMaterial();
    });
    
    // Color pickers
    document.getElementById('base-color').addEventListener('change', updateMaterial);
    document.getElementById('specular-color').addEventListener('change', updateMaterial);
    document.getElementById('emissive-color').addEventListener('change', updateMaterial);
    
    // PBR Presets
    document.getElementById('preset-plastic').addEventListener('click', () => {
      document.getElementById('material-type').value = 'standard';
      document.getElementById('material-type').dispatchEvent(new Event('change'));
      document.getElementById('metalness').value = 0;
      document.getElementById('roughness').value = 30;
      document.getElementById('metalness-value').textContent = '0%';
      document.getElementById('roughness-value').textContent = '30%';
      updateMaterial();
    });
    
    document.getElementById('preset-metal').addEventListener('click', () => {
      document.getElementById('material-type').value = 'standard';
      document.getElementById('material-type').dispatchEvent(new Event('change'));
      document.getElementById('metalness').value = 100;
      document.getElementById('roughness').value = 20;
      document.getElementById('base-color').value = '#888888';
      document.getElementById('metalness-value').textContent = '100%';
      document.getElementById('roughness-value').textContent = '20%';
      updateMaterial();
    });
    
    document.getElementById('preset-gold').addEventListener('click', () => {
      document.getElementById('material-type').value = 'standard';
      document.getElementById('material-type').dispatchEvent(new Event('change'));
      document.getElementById('metalness').value = 100;
      document.getElementById('roughness').value = 10;
      document.getElementById('base-color').value = '#FFD700';
      document.getElementById('metalness-value').textContent = '100%';
      document.getElementById('roughness-value').textContent = '10%';
      updateMaterial();
    });
    
    document.getElementById('preset-copper').addEventListener('click', () => {
      document.getElementById('material-type').value = 'standard';
      document.getElementById('material-type').dispatchEvent(new Event('change'));
      document.getElementById('metalness').value = 100;
      document.getElementById('roughness').value = 30;
      document.getElementById('base-color').value = '#B87333';
      document.getElementById('metalness-value').textContent = '100%';
      document.getElementById('roughness-value').textContent = '30%';
      updateMaterial();
    });
    
    document.getElementById('preset-rubber').addEventListener('click', () => {
      document.getElementById('material-type').value = 'standard';
      document.getElementById('material-type').dispatchEvent(new Event('change'));
      document.getElementById('metalness').value = 0;
      document.getElementById('roughness').value = 80;
      document.getElementById('base-color').value = '#1a1a1a';
      document.getElementById('metalness-value').textContent = '0%';
      document.getElementById('roughness-value').textContent = '80%';
      updateMaterial();
    });
    
    document.getElementById('preset-glass').addEventListener('click', () => {
      document.getElementById('material-type').value = 'physical';
      document.getElementById('material-type').dispatchEvent(new Event('change'));
      document.getElementById('metalness').value = 0;
      document.getElementById('roughness').value = 0;
      document.getElementById('opacity').value = 30;
      document.getElementById('metalness-value').textContent = '0%';
      document.getElementById('roughness-value').textContent = '0%';
      document.getElementById('opacity-value').textContent = '30%';
      updateMaterial();
    });
    
    document.getElementById('preset-ice').addEventListener('click', () => {
      document.getElementById('material-type').value = 'physical';
      document.getElementById('material-type').dispatchEvent(new Event('change'));
      document.getElementById('metalness').value = 0;
      document.getElementById('roughness').value = 5;
      document.getElementById('opacity').value = 70;
      document.getElementById('base-color').value = '#E0F7FA';
      document.getElementById('metalness-value').textContent = '0%';
      document.getElementById('roughness-value').textContent = '5%';
      document.getElementById('opacity-value').textContent = '70%';
      updateMaterial();
    });
    
    document.getElementById('preset-ceramic').addEventListener('click', () => {
      document.getElementById('material-type').value = 'standard';
      document.getElementById('material-type').dispatchEvent(new Event('change'));
      document.getElementById('metalness').value = 0;
      document.getElementById('roughness').value = 5;
      document.getElementById('base-color').value = '#F5F5DC';
      document.getElementById('metalness-value').textContent = '0%';
      document.getElementById('roughness-value').textContent = '5%';
      updateMaterial();
    });
    
    // Setup enhanced lighting for PBR
    viewer.scene.remove(viewer.ambientLight);
    viewer.scene.remove(viewer.directionalLight);
    
    // Add environment lighting (important for PBR)
    const ambientLight = new THREE.AmbientLight(0x404040, 0.5);
    viewer.scene.add(ambientLight);
    
    // Add multiple directional lights for better PBR
    const mainLight = new THREE.DirectionalLight(0xffffff, 1.0);
    mainLight.position.set(100, 100, 50);
    viewer.scene.add(mainLight);
    
    const fillLight = new THREE.DirectionalLight(0xffffff, 0.5);
    fillLight.position.set(-100, -100, -50);
    viewer.scene.add(fillLight);
    
    const rimLight = new THREE.DirectionalLight(0xffffff, 0.3);
    rimLight.position.set(0, 100, -100);
    viewer.scene.add(rimLight);
    
    // Initialize with test surface
    createTestSurface();
    
    // Handle window resize
    window.addEventListener('resize', () => {
      viewer.resize(window.innerWidth, window.innerHeight);
    });
  </script>
</body>
</html>